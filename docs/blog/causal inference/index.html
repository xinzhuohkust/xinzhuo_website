<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.169">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Xinzhuo Huang">
<meta name="dcterms.date" content="2023-05-15">
<meta name="description" content="with R">
<title>Xinzhuo Huang - Causal Inference Practical Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../icon_sun.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7HHBQV7LX3"></script><script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-7HHBQV7LX3', { 'anonymize_ip': true});
</script><script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script><style>html{ scroll-behavior: smooth; }</style>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../../scss/styles.css">
<meta property="og:title" content="Xinzhuo Huang - Causal Inference Practical Methods">
<meta property="og:description" content="with R">
<meta property="og:site_name" content="Xinzhuo Huang">
<meta name="twitter:title" content="Xinzhuo Huang - Causal Inference Practical Methods">
<meta name="twitter:description" content="with R">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../icon_sun.png" alt="" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../cv/" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html" rel="" target="">
 <span class="menu-text">BLOG</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../data/index.html" rel="" target="">
 <span class="menu-text">DATA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../project/index.html" rel="" target="">
 <span class="menu-text">PROJECT</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog/index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">
<li>
    <a class="dropdown-item" href="https://github.com/xinzhuohkust/xinzhuo" rel="" target="">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/xinzhuohkust/xinzhuo/issues" rel="" target="">
 <span class="dropdown-text">Report a Bug</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li>
<a href="#fixed-effects" id="toc-fixed-effects" class="nav-link" data-scroll-target="#fixed-effects">Fixed Effects</a>
  <ul class="collapse">
<li><a href="#linear-dummy-variabel-model" id="toc-linear-dummy-variabel-model" class="nav-link" data-scroll-target="#linear-dummy-variabel-model">Linear Dummy Variabel Model</a></li>
  <li><a href="#fixed-effect-in-standard-packages" id="toc-fixed-effect-in-standard-packages" class="nav-link" data-scroll-target="#fixed-effect-in-standard-packages">Fixed effect in standard packages</a></li>
  </ul>
</li>
  <li>
<a href="#did" id="toc-did" class="nav-link" data-scroll-target="#did">DiD</a>
  <ul class="collapse">
<li><a href="#pre-trends" id="toc-pre-trends" class="nav-link" data-scroll-target="#pre-trends">Pre-trends</a></li>
  <li><a href="#did-as-a-linear-regression-with-interaction" id="toc-did-as-a-linear-regression-with-interaction" class="nav-link" data-scroll-target="#did-as-a-linear-regression-with-interaction">DiD as a linear regression with interaction</a></li>
  <li><a href="#did-asd-fixed-effect" id="toc-did-asd-fixed-effect" class="nav-link" data-scroll-target="#did-asd-fixed-effect">DiD asd fixed effect</a></li>
  <li><a href="#time-invariant-variables-in-fixed-effect-regressions" id="toc-time-invariant-variables-in-fixed-effect-regressions" class="nav-link" data-scroll-target="#time-invariant-variables-in-fixed-effect-regressions">Time-invariant variables in fixed effect regressions</a></li>
  </ul>
</li>
  <li>
<a href="#instrumental-variable" id="toc-instrumental-variable" class="nav-link" data-scroll-target="#instrumental-variable">Instrumental Variable</a>
  <ul class="collapse">
<li><a href="#iv-estimate" id="toc-iv-estimate" class="nav-link" data-scroll-target="#iv-estimate">IV estimate</a></li>
  <li><a href="#manual-2sls" id="toc-manual-2sls" class="nav-link" data-scroll-target="#manual-2sls">Manual 2SLS</a></li>
  <li><a href="#weak-instrument" id="toc-weak-instrument" class="nav-link" data-scroll-target="#weak-instrument">Weak instrument</a></li>
  <li><a href="#interpretation-of-effect" id="toc-interpretation-of-effect" class="nav-link" data-scroll-target="#interpretation-of-effect">Interpretation of effect</a></li>
  </ul>
</li>
  <li>
<a href="#sharp-rd" id="toc-sharp-rd" class="nav-link" data-scroll-target="#sharp-rd">Sharp RD</a>
  <ul class="collapse">
<li><a href="#rd-plot" id="toc-rd-plot" class="nav-link" data-scroll-target="#rd-plot">RD plot</a></li>
  <li><a href="#density-test" id="toc-density-test" class="nav-link" data-scroll-target="#density-test">Density Test</a></li>
  <li><a href="#rd-bandwidth-selection" id="toc-rd-bandwidth-selection" class="nav-link" data-scroll-target="#rd-bandwidth-selection">RD bandwidth selection</a></li>
  <li><a href="#estimate-sharp-rd-treatment-effect" id="toc-estimate-sharp-rd-treatment-effect" class="nav-link" data-scroll-target="#estimate-sharp-rd-treatment-effect">Estimate Sharp RD treatment effect</a></li>
  <li><a href="#varying-orders-of-polynomial-regression" id="toc-varying-orders-of-polynomial-regression" class="nav-link" data-scroll-target="#varying-orders-of-polynomial-regression">Varying orders of polynomial regression</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Causal Inference Practical Methods</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">DiD</div>
    <div class="quarto-category">RD</div>
    <div class="quarto-category">IV</div>
    <div class="quarto-category">Causal Inference</div>
  </div>
  </div>

<div>
  <div class="description">
    with R
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Xinzhuo Huang <a href="https://orcid.org/0009-0007-6448-5114" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            HKUST SOSC
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 15, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header><style>
body {text-align: justify}
</style>
<section id="setup" class="level1 unnumbered"><h1 class="unnumbered">Setup</h1>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/trinker/pacman">"pacman"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tibble</span>, <span class="va">dplyr</span>, <span class="va">furrr</span>, <span class="va">purrr</span>, <span class="va">tidyr</span>, <span class="va">stringr</span>, <span class="va">rio</span>, <span class="va">ggplot2</span>, <span class="va">knitr</span>, <span class="va">broom</span>, <span class="va">kableExtra</span>,</span>
<span>    <span class="va">lfe</span>, <span class="va">plm</span>, <span class="va">ggthemes</span>, <span class="va">skimr</span>, <span class="va">ggpmisc</span>, <span class="va">sysfonts</span>, <span class="va">extrafont</span>, <span class="va">AER</span>, <span class="va">dagitty</span>, <span class="va">ggdag</span>,</span>
<span>    <span class="va">rdrobust</span>, <span class="va">rddensity</span>, <span class="va">did</span><span class="op">)</span></span>
<span></span>
<span><span class="va">print_kable</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">result</span>, <span class="va">title</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">kable</span><span class="op">(</span><span class="va">result</span>, digits <span class="op">=</span> <span class="fl">3</span>, caption <span class="op">=</span> <span class="va">title</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="fixed-effects" class="level1"><h1>Fixed Effects</h1>
<section id="linear-dummy-variabel-model" class="level2"><h2 class="anchored" data-anchor-id="linear-dummy-variabel-model">Linear Dummy Variabel Model</h2>
<p>Fixed effects model shows that the beer tax does reduce fatalities.</p>
<div class="cell caption-top">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fatality</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"E:/OneDrive - HKUST Connect/assignment/assignment3/fatality.csv"</span>,</span>
<span>    setclass <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fatality</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">beertax</span>, y <span class="op">=</span> <span class="va">fatality_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">state</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">state</span>, color <span class="op">=</span> <span class="va">state</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#8E8E93"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Beer Tax"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Fatalities"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">The relationship between the beer tax and fatality</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_dummy_formula</span> <span class="op">&lt;-</span> <span class="va">fatality</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pull</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"`%s`"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">str_c</span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">str_c</span><span class="op">(</span><span class="st">"fatality_rate ~ 0 + beertax + "</span>, <span class="va">.</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linear_dummy</span> <span class="op">&lt;-</span> <span class="va">fatality</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">state</span>, values_from <span class="op">=</span> <span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">50</span>, <span class="op">~</span><span class="fu">str_replace</span><span class="op">(</span><span class="va">.</span>, <span class="st">"\\w+"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>, <span class="fu">across</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">50</span>, <span class="op">~</span><span class="fu">replace_na</span><span class="op">(</span><span class="va">.</span>,</span>
<span>        <span class="st">"0"</span><span class="op">)</span><span class="op">)</span>, <span class="fu">across</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">50</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">linear_dummy_formula</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linear_dummy</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Linear dummy variable model"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Linear dummy variable model</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">beertax</td>
<td style="text-align: right;">-0.656</td>
<td style="text-align: right;">0.188</td>
<td style="text-align: right;">-3.491</td>
<td style="text-align: right;">0.001</td>
</tr></tbody>
</table>
</div>
</div>
</section><section id="fixed-effect-in-standard-packages" class="level2"><h2 class="anchored" data-anchor-id="fixed-effect-in-standard-packages">Fixed effect in standard packages</h2>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fixed_effect_plm</span> <span class="op">&lt;-</span> <span class="va">fatality</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pdata.frame</span><span class="op">(</span>index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">plm</span><span class="op">(</span><span class="va">fatality_rate</span> <span class="op">~</span> <span class="va">beertax</span>, data <span class="op">=</span> <span class="va">.</span>, model <span class="op">=</span> <span class="st">"within"</span>, effect <span class="op">=</span> <span class="st">"individual"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fixed_clustered_plm</span> <span class="op">&lt;-</span> <span class="va">fixed_effect_plm</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>category <span class="op">=</span> <span class="st">"fixed effects with plm"</span>, std.error <span class="op">=</span> <span class="fu">vcovHC</span><span class="op">(</span><span class="va">fixed_effect_plm</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"HC1"</span>, cluster <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span>, statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fixed_effect_plm</span><span class="op">)</span><span class="op">/</span><span class="va">std.error</span>, p.value <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">pt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span>,</span>
<span>        df <span class="op">=</span> <span class="va">fixed_effect_plm</span><span class="op">$</span><span class="va">df.residual</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fixed_clustered_lfe</span> <span class="op">&lt;-</span> <span class="va">fatality</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">felm</span><span class="op">(</span><span class="va">fatality_rate</span> <span class="op">~</span> <span class="va">beertax</span> <span class="op">|</span> <span class="va">state</span>, cluster <span class="op">=</span> <span class="st">"state"</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>category <span class="op">=</span> <span class="st">"fixed effects with lfe"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fixed_clustered_lfe</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">bind_rows</span><span class="op">(</span><span class="va">fixed_clustered_plm</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Fixed effect in standard packages"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Fixed effect in standard packages</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">category</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beertax</td>
<td style="text-align: right;">-0.656</td>
<td style="text-align: right;">0.292</td>
<td style="text-align: right;">-2.247</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: left;">fixed effects with lfe</td>
</tr>
<tr class="even">
<td style="text-align: left;">beertax</td>
<td style="text-align: right;">-0.656</td>
<td style="text-align: right;">0.289</td>
<td style="text-align: right;">-2.271</td>
<td style="text-align: right;">0.024</td>
<td style="text-align: left;">fixed effects with plm</td>
</tr>
</tbody>
</table>
</div>
</div>
</section></section><section id="did" class="level1"><h1>DiD</h1>
<section id="pre-trends" class="level2"><h2 class="anchored" data-anchor-id="pre-trends">Pre-trends</h2>
<p>Based on the figure, the parallel trend assumption may not hold, as we can see that the crime rates in Muslim/Jewish neighborhoods experienced two episodes of first decreasing, then increasing again, before increasing prior to the intervention. However, the Non Muslim/Jewish only experienced one episodes.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cartheft</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"E:/OneDrive - HKUST Connect/assignment/assignment3/cartheft.dta"</span>,</span>
<span>    setclass <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">distance</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cartheft</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">month</span>, <span class="va">treatment</span>, <span class="va">postattack</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cartheft</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">treatment</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.2</span>, linetype <span class="op">=</span> <span class="st">"twodash"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">8</span>, linetype <span class="op">=</span> <span class="st">"dotdash"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"#8E8E93"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Month"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Mean crime rates"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">0.064</span>, label <span class="op">=</span> <span class="st">"Muslim/Jewish"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3.6</span>, fontface <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">0.112</span>, label <span class="op">=</span> <span class="st">"Non Muslim/Jewish"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3.6</span>, fontface <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Pre-trends test</figcaption></figure>
</div>
</div>
</div>
</section><section id="did-as-a-linear-regression-with-interaction" class="level2"><h2 class="anchored" data-anchor-id="did-as-a-linear-regression-with-interaction">DiD as a linear regression with interaction</h2>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">did_interaction</span> <span class="op">&lt;-</span> <span class="va">cartheft</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">cartheft</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">postattack</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">*</span> <span class="va">postattack</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">slice</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>term <span class="op">=</span> <span class="st">"Same-Block Police"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">did_interaction</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span><span class="va">.</span>, title <span class="op">=</span> <span class="st">"linear regression with interaction"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>linear regression with interaction</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">Same-Block Police</td>
<td style="text-align: right;">-0.078</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: right;">-2.847</td>
<td style="text-align: right;">0.004</td>
</tr></tbody>
</table>
</div>
</div>
</section><section id="did-asd-fixed-effect" class="level2"><h2 class="anchored" data-anchor-id="did-asd-fixed-effect">DiD asd fixed effect</h2>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">did_fixed</span> <span class="op">&lt;-</span> <span class="va">cartheft</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">felm</span><span class="op">(</span><span class="va">cartheft</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">*</span> <span class="va">postattack</span> <span class="op">|</span> <span class="va">blockid</span> <span class="op">+</span> <span class="va">month</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">slice</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>term <span class="op">=</span> <span class="st">"Same-Block * Postattack"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">did_fixed</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Two way fixed effect model"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Two way fixed effect model</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">Same-Block * Postattack</td>
<td style="text-align: right;">-0.078</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">-2.992</td>
<td style="text-align: right;">0.003</td>
</tr></tbody>
</table>
</div>
</div>
</section><section id="time-invariant-variables-in-fixed-effect-regressions" class="level2"><h2 class="anchored" data-anchor-id="time-invariant-variables-in-fixed-effect-regressions">Time-invariant variables in fixed effect regressions</h2>
<p>We cannot estimate the coefficient for time-invariant variables since they are absorbed by the individual fixed effects.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">did_fixed_invariant</span> <span class="op">&lt;-</span> <span class="va">cartheft</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">felm</span><span class="op">(</span><span class="va">cartheft</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">*</span> <span class="va">postattack</span> <span class="op">+</span> <span class="va">bank</span> <span class="op">|</span> <span class="va">blockid</span> <span class="op">+</span> <span class="va">month</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">slice</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Bank"</span>, <span class="st">"Same-Block * Postattack"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">did_fixed_invariant</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Time-invariant variables in regression"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Time-invariant variables in regression</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bank</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
</tr>
<tr class="even">
<td style="text-align: left;">Same-Block * Postattack</td>
<td style="text-align: right;">-0.078</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">-2.992</td>
<td style="text-align: right;">0.003</td>
</tr>
</tbody>
</table>
</div>
</div>
</section></section><section id="instrumental-variable" class="level1"><h1>Instrumental Variable</h1>
<span class="math display">\[\begin{align*}
\log(wage) = \beta_{0} + \beta_{1}educ
\end{align*}\]</span>
<span class="math display">\[\begin{align*}                
educ = \gamma_{0} + \gamma_{1}educ
\end{align*}\]</span>
<section id="iv-estimate" class="level2"><h2 class="anchored" data-anchor-id="iv-estimate">IV estimate</h2>
<p>The IV estimator is larger than the OLS estimator. Since in this study, IV is used to address endogeneity by providing a source of variation in the predictor variable that is independent of the error term. In that case, IV estimate accounts for endogeneity and provides a more reliable estimate of the true causal effect of the predictor variable on the outcome variable. The OLS estimate, on the other hand, may be biased and inconsistent in the presence of endogeneity, leading to an underestimate of the true effect size.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, <span class="op">~</span><span class="va">label</span>, <span class="op">~</span><span class="va">x</span>, <span class="op">~</span><span class="va">y</span>, <span class="st">"educ"</span>, <span class="st">"Educ"</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="st">"wage"</span>, <span class="st">"Wage"</span>, <span class="fl">5</span>, <span class="fl">1</span>,</span>
<span>    <span class="st">"e"</span>, <span class="st">"Confounders"</span>, <span class="fl">4.5</span>, <span class="fl">1.5</span>, <span class="st">"Z"</span>, <span class="st">"Instrumental Variable"</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">node_labels</span> <span class="op">&lt;-</span> <span class="va">dag</span><span class="op">$</span><span class="va">label</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">node_labels</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dag</span><span class="op">$</span><span class="va">name</span></span>
<span></span>
<span><span class="va">status_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="st">"#00BFFF"</span>, outcome <span class="op">=</span> <span class="st">"#FF7F50"</span>, latent <span class="op">=</span> <span class="st">"#D3D3D3"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dagify</span><span class="op">(</span><span class="va">wage</span> <span class="op">~</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">e</span>, <span class="va">educ</span> <span class="op">~</span> <span class="va">e</span>, <span class="va">educ</span> <span class="op">~</span> <span class="va">Z</span>, exposure <span class="op">=</span> <span class="st">"educ"</span>, outcome <span class="op">=</span> <span class="st">"wage"</span>,</span>
<span>    latent <span class="op">=</span> <span class="st">"e"</span>, coords <span class="op">=</span> <span class="va">dag</span>, labels <span class="op">=</span> <span class="va">node_labels</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy_dagitty</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">node_status</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_dag_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_dag_label_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">label</span>, fill <span class="op">=</span> <span class="va">status</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">status_colors</span>, na.value <span class="op">=</span> <span class="st">"grey20"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">status_colors</span>,</span>
<span>    na.value <span class="op">=</span> <span class="st">"grey20"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Directed Acyclic Graphs</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">card</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"E:/OneDrive - HKUST Connect/assignment/assignment3/card.csv"</span>, setclass <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ols</span> <span class="op">&lt;-</span> <span class="va">card</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">educ</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">coeftest</span><span class="op">(</span><span class="va">vcovHC</span>, <span class="st">"HC1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">slice</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"OLS with robust std.error"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">iv</span> <span class="op">&lt;-</span> <span class="va">card</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ivreg</span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">educ</span> <span class="op">|</span> <span class="va">nearc4</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">coeftest</span><span class="op">(</span><span class="va">vcovHC</span>, <span class="st">"HC1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">slice</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"IV with robust std.error"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bind_rows</span><span class="op">(</span><span class="va">ols</span>, <span class="va">iv</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparison between OLS and IV"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Comparison between OLS and IV</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">method</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">educ</td>
<td style="text-align: right;">0.052</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">17.902</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">OLS with robust std.error</td>
</tr>
<tr class="even">
<td style="text-align: left;">educ</td>
<td style="text-align: right;">0.188</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">7.189</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">IV with robust std.error</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="manual-2sls" class="level2"><h2 class="anchored" data-anchor-id="manual-2sls">Manual 2SLS</h2>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">first_stage</span> <span class="op">&lt;-</span> <span class="va">card</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">educ</span> <span class="op">~</span> <span class="va">nearc4</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">manual</span> <span class="op">&lt;-</span> <span class="va">card</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>educ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">first_stage</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">educ</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">coeftest</span><span class="op">(</span><span class="va">vcovHC</span>, <span class="st">"HC1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">slice</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Manual 2SLS with robust std.error"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bind_rows</span><span class="op">(</span><span class="va">manual</span>, <span class="va">iv</span>, <span class="va">ols</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparison between OLS, IV and manual 2SLS"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Comparison between OLS, IV and manual 2SLS</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">method</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">educ</td>
<td style="text-align: right;">0.188</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">9.149</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Manual 2SLS with robust std.error</td>
</tr>
<tr class="even">
<td style="text-align: left;">educ</td>
<td style="text-align: right;">0.188</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">7.189</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">IV with robust std.error</td>
</tr>
<tr class="odd">
<td style="text-align: left;">educ</td>
<td style="text-align: right;">0.052</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">17.902</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">OLS with robust std.error</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="weak-instrument" class="level2"><h2 class="anchored" data-anchor-id="weak-instrument">Weak instrument</h2>
<p>The F statistics from the first-stage regression is larger than 10.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">waldtest</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">nearc4</span>, <span class="va">card</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">educ</span>, <span class="va">card</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="va">tidy</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">rename</span><span class="op">(</span>F.statistic <span class="op">=</span> <span class="va">statistic</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weak instrument test"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Weak instrument test</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df.residual</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">F.statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lwage ~ educ + nearc4</td>
<td style="text-align: right;">3007</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">lwage ~ educ</td>
<td style="text-align: right;">3008</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">48.451</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="interpretation-of-effect" class="level2"><h2 class="anchored" data-anchor-id="interpretation-of-effect">Interpretation of effect</h2>
<ul>
<li>Compliers are the individuals whose decision to attend college is influenced by the instrumental variable. In this study, compliers are the students who would attend college if they lived close to one and would not attend college if they lived far away. These students decisions are directly impacted by the geographical distance to college.</li>
<li>Always-takers are the individuals who would attend college regardless of the geographical distance. These students would pursue higher education even if they lived far away from a college.</li>
</ul></section></section><section id="sharp-rd" class="level1"><h1>Sharp RD</h1>
<section id="rd-plot" class="level2"><h2 class="anchored" data-anchor-id="rd-plot">RD plot</h2>
<p>We can observe a clear difference around the cutoff.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">senate</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"E:/OneDrive - HKUST Connect/assignment/assignment3/senate.csv"</span>,</span>
<span>    setclass <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cutoff <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">margin</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">senate</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">margin</span>, y <span class="op">=</span> <span class="va">vote</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">cutoff</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0</span>, height <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">senate</span>,</span>
<span>    <span class="va">margin</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">margin</span>, y <span class="op">=</span> <span class="va">vote</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, color <span class="op">=</span> <span class="st">"#8E8E93"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">senate</span>,</span>
<span>    <span class="va">margin</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">margin</span>, y <span class="op">=</span> <span class="va">vote</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, color <span class="op">=</span> <span class="st">"#8E8E93"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FF7F50"</span>,</span>
<span>    <span class="st">"#00BFFF"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dotdash"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Winning margin of a Democratic party senator"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Share of vote of the senator in election"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Raw RD plot</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">rdplot</span><span class="op">(</span>y <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">vote</span>, x <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">margin</span>, nbins <span class="op">=</span> <span class="fl">10</span>, x.label <span class="op">=</span> <span class="st">"Winning margin of a Democratic party senator"</span>,</span>
<span>    y.label <span class="op">=</span> <span class="st">"Share of vote of the senator in election"</span>, title <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Binned RD plot</figcaption></figure>
</div>
</div>
</div>
</section><section id="density-test" class="level2"><h2 class="anchored" data-anchor-id="density-test">Density Test</h2>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">density_plot</span> <span class="op">&lt;-</span> <span class="fu">rddensity</span><span class="op">(</span><span class="va">senate</span><span class="op">$</span><span class="va">margin</span>, c <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">rdplotdensity</span><span class="op">(</span>rdd <span class="op">=</span> <span class="va">.</span>, X <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">margin</span>, type <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pluck</span><span class="op">(</span><span class="st">"Estplot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Density Test</figcaption></figure>
</div>
</div>
</div>
</section><section id="rd-bandwidth-selection" class="level2"><h2 class="anchored" data-anchor-id="rd-bandwidth-selection">RD bandwidth selection</h2>
<p>The obtained bandwidth is 24.969. We estimate the RD effect using three different bandwidth values (ideal, twice the ideal, and half of the ideal) to determine if the value is appropriate. As we can see, the coefficients change substantially. It is considered a big bandwidth since it includes more observations in our analysis.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">rdbwselect</span><span class="op">(</span>y <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">vote</span>, x <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">margin</span>, c <span class="op">=</span> <span class="fl">0</span>, p <span class="op">=</span> <span class="fl">3</span>, kernel <span class="op">=</span> <span class="st">"triangular"</span>,</span>
<span>    bwselect <span class="op">=</span> <span class="st">"mserd"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pluck</span><span class="op">(</span><span class="st">"bws"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BW est left"</span>, <span class="st">"BW est right"</span>, <span class="st">"BW bias left"</span>, <span class="st">"BW bias right"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"RD bandwidth selection"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>RD bandwidth selection</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">BW est left</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BW est right</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BW bias left</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BW bias right</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">24.969</td>
<td style="text-align: right;">24.969</td>
<td style="text-align: right;">37.221</td>
<td style="text-align: right;">37.221</td>
</tr></tbody>
</table>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rd_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">24.969</span>, <span class="fl">24.969</span> <span class="op">*</span> <span class="fl">2</span>, <span class="fl">24.969</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">map</span><span class="op">(</span><span class="op">~</span><span class="fu">rdrobust</span><span class="op">(</span>y <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">vote</span>, x <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">margin</span>, p <span class="op">=</span> <span class="fl">3</span>, h <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">extract_se_es</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">tibble</span><span class="op">(</span>Estimate <span class="op">=</span> <span class="fu">pluck</span><span class="op">(</span><span class="va">x</span>, <span class="st">"Estimate"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, Se <span class="op">=</span> <span class="fu">pluck</span><span class="op">(</span><span class="va">x</span>, <span class="st">"se"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, `P-Value` <span class="op">=</span> <span class="fu">pluck</span><span class="op">(</span><span class="va">x</span>,</span>
<span>        <span class="st">"pv"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rd_models</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">map_dfr</span><span class="op">(</span><span class="va">extract_se_es</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Bandwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"24.969 (ideal)"</span>, <span class="st">"49.938 (twice)"</span>, <span class="st">"12.485 (half)"</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sensitivity analysis using different bandwidths"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Sensitivity analysis using different bandwidths</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Bandwidth</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Se</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">P-Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">24.969 (ideal)</td>
<td style="text-align: right;">9.126</td>
<td style="text-align: right;">2.314</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">49.938 (twice)</td>
<td style="text-align: right;">7.676</td>
<td style="text-align: right;">1.781</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12.485 (half)</td>
<td style="text-align: right;">13.872</td>
<td style="text-align: right;">3.126</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="estimate-sharp-rd-treatment-effect" class="level2"><h2 class="anchored" data-anchor-id="estimate-sharp-rd-treatment-effect">Estimate Sharp RD treatment effect</h2>
<p>The model result shows that there is an incumbency advantage.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sharp_rd</span> <span class="op">&lt;-</span> <span class="fu">rdrobust</span><span class="op">(</span>y <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">vote</span>, x <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">margin</span>, h <span class="op">=</span> <span class="fl">24.96899</span>, p <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="op">(</span>Estimate <span class="op">=</span> <span class="fu">pluck</span><span class="op">(</span><span class="va">sharp_rd</span>, <span class="st">"Estimate"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, Se <span class="op">=</span> <span class="fu">pluck</span><span class="op">(</span><span class="va">sharp_rd</span>, <span class="st">"se"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    `P-Value` <span class="op">=</span> <span class="fu">pluck</span><span class="op">(</span><span class="va">sharp_rd</span>, <span class="st">"pv"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sharp RD treatment effect"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Sharp RD treatment effect</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Se</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">P-Value</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">9.126</td>
<td style="text-align: right;">2.314</td>
<td style="text-align: right;">0</td>
</tr></tbody>
</table>
</div>
</div>
</section><section id="varying-orders-of-polynomial-regression" class="level2"><h2 class="anchored" data-anchor-id="varying-orders-of-polynomial-regression">Varying orders of polynomial regression</h2>
<p>Models with different bandwidth all support the same conclusion.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">map</span><span class="op">(</span><span class="op">~</span><span class="fu">rdrobust</span><span class="op">(</span>y <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">vote</span>, x <span class="op">=</span> <span class="va">senate</span><span class="op">$</span><span class="va">margin</span>, p <span class="op">=</span> <span class="va">.</span>, h <span class="op">=</span> <span class="fl">24.96899</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">map_dfr</span><span class="op">(</span><span class="va">extract_se_es</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>`Local-polynomial` <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">print_kable</span><span class="op">(</span><span class="st">"Varying orders of polynomial regression"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Varying orders of polynomial regression</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Local-polynomial</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Se</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">P-Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.103</td>
<td style="text-align: right;">1.264</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">7.854</td>
<td style="text-align: right;">1.797</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">9.126</td>
<td style="text-align: right;">2.314</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">11.556</td>
<td style="text-align: right;">2.882</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      try { hash = new URL(url).hash; } catch {}
      const id = hash.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note !== null) {
        try {
          const html = processXRef(id, note);
          instance.setContent(html);
        } finally {
          instance.enable();
          instance.show();
        }
      } else {
        // See if we can fetch this
        fetch(url.split('#')[0])
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.getElementById(id);
          if (note !== null) {
            const html = processXRef(id, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/xinzhuo\.work");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><script src="https://giscus.app/client.js" data-repo="xinzhuohkust/comments" data-repo-id="R_kgDOIfEW2g" data-category="General" data-category-id="DIC_kwDOIfEW2s4CStOg" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="light">
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Powered by <a href="https://quarto.org">Quarto</a> |  2023 <a href="../..\cv/">Xinzhuo Huang</a></p>
<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>